<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Ghidorah no Sekai — Rare Manga & Comics Showcase | Vintage, Rari, Manga & Comics</title>
<meta name="description" content="Ghidorah no Sekai: showcase of rare, vintage and underground manga & comics from Italy, USA, Japan, and China. Limited runs, historic prints, unique pieces.">
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+Antique:wght@700&display=swap" rel="stylesheet" />
<link rel="dns-prefetch" href="https://www.gstatic.com" />
<link rel="dns-prefetch" href="https://firebasestorage.googleapis.com" />
<link rel="dns-prefetch" href="https://wandernatureconnect-default-rtdb.europe-west1.firebasedatabase.app" />
<meta name="theme-color" content="#000000" />
<link rel="canonical" id="canon" href="/" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Ghidorah no Sekai — Rare Manga & Comics Showcase" />
<meta property="og:description" content="Vault of rare and vintage manga & comics. Underground picks and limited editions." />
<meta property="og:image" content="Ghidorah1.png" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Ghidorah no Sekai — Rare Manga & Comics Showcase" />
<meta name="twitter:description" content="Rare & vintage comics and manga. Curated unique pieces." />
<meta name="twitter:image" content="Ghidorah1.png" />
<meta name="color-scheme" content="dark" />
<style>
:root{--bg:#0a0a0a;--text:#e9e9e9;--muted:#a6a6a6;--gold:#ffd700;--gold-dark:#b8860b;--border:#232323;--card:#111214;--ring:rgba(255,215,0,.5);--gap:12px;--radius:14px;--card-media-ratio:3/4;--body-extra:120px}
@media (max-width:680px){:root{--gap:9px;--body-extra:110px}}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Zen Kaku Gothic Antique',system-ui,Segoe UI,Roboto,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}
body::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:-1;background:radial-gradient(1000px 480px at 50% -10%,rgba(255,215,0,0.05),transparent 60%),radial-gradient(760px 420px at -20% 120%,rgba(184,134,11,0.04),transparent 60%),repeating-conic-gradient(from 0deg,rgba(255,255,255,0.01) 0 10deg,transparent 10deg 20deg)}
.topbar{position:sticky;top:0;z-index:30;display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);background:#0b0b0bd9;backdrop-filter:blur(6px)}
.brand-mini{display:flex;align-items:center;gap:8px}
.brand-mini img{width:28px;height:28px;border-radius:50%}
.rules{display:inline-flex;align-items:center;gap:.4rem;padding:.5rem .9rem;border-radius:999px;background:linear-gradient(90deg,#1a1400,#2b2200);border:1px solid rgba(255,215,0,.25);color:#FFD700;font-weight:800;letter-spacing:.08em;text-decoration:none}
.searchbar{flex:1;display:flex;align-items:center;gap:.5rem;max-width:560px}
.searchbar input{flex:1;background:#101012;border:1px solid var(--border);border-radius:10px;color:#fff;padding:.6rem .8rem;outline:none}
.searchbar input:focus{box-shadow:0 0 0 3px var(--ring)}
.controls{display:flex;gap:.5rem;justify-content:center;align-items:center;flex-wrap:wrap;padding:.3rem 1rem 0}
.control-chip{background:linear-gradient(180deg,#0d0d0f,#17171a);border:1px solid #222;border-radius:999px;padding:.6rem .9rem;color:#cfcfcf;font-size:.9rem;cursor:pointer;user-select:none;min-height:40px}
.control-chip[aria-pressed="true"]{outline:2px solid #ffd70055;color:var(--gold);border-color:#3a2e00}
header{text-align:center;padding:1.1rem 1rem .5rem;display:flex;flex-direction:column;align-items:center;gap:.6rem}
.logo-wrapper{position:relative;display:inline-block}
.logo-glow{position:absolute;top:50%;left:50%;width:140px;height:140px;border-radius:50%;background:radial-gradient(circle,rgba(255,215,0,0.5) 0%,rgba(255,215,0,0) 70%);transform:translate(-50%,-50%);filter:blur(12px);z-index:0}
img.logo{position:relative;z-index:1;width:96px;height:96px;border-radius:50%;object-fit:cover}
h1{font-size:clamp(1.6rem,5vw,2.4rem);background:linear-gradient(90deg,var(--gold),var(--gold-dark),var(--gold));background-size:200% auto;color:transparent;-webkit-background-clip:text;background-clip:text;letter-spacing:.12em;margin:.2rem 0 0}
.subtitle{font-size:.98rem;color:var(--muted)}
.jp-bottom{font-size:1.05rem;color:#bbb8;letter-spacing:.5em}
.container{max-width:1100px;margin:0 auto 1.6rem;padding:14px}
.grid{display:grid;gap:var(--gap);grid-template-columns:repeat(auto-fill,minmax(180px,1fr))}
@media (max-width:480px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
.skel{background:linear-gradient(180deg,#0d0d10,#131317);border:1px solid #1e1e22;border-radius:var(--radius);overflow:hidden;min-height:calc((100% / (var(--card-media-ratio))) + var(--body-extra));position:relative}
footer{text-align:center;font-size:.85rem;color:#888a;padding:1.2rem 1rem;border-top:1px solid #222}
vault-card{display:block;height:100%;content-visibility:auto;contain-intrinsic-size:auto 420px}
.viewer{position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center}
.viewer.active{display:flex}
.viewer img{max-width:96vw;max-height:72vh;object-fit:contain;image-orientation:from-image}
.viewer .nav{position:absolute;top:50%;transform:translateY(-50%);width:42px;height:42px;border-radius:50%;border:1px solid #444;background:#111;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}
.viewer .prev{left:12px}.viewer .next{right:12px}
.viewer .close{position:absolute;top:12px;right:12px;width:40px;height:40px;border-radius:50%;border:1px solid #444;background:#111;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}
.viewer .thumbs{position:absolute;left:0;right:0;bottom:8px;display:flex;gap:6px;justify-content:center;flex-wrap:nowrap;overflow:auto;padding:6px 10px}
.viewer .thumbs::-webkit-scrollbar{height:6px}
.viewer .thumb{width:56px;height:56px;border:1px solid #555;border-radius:8px;overflow:hidden;flex:0 0 auto;background:#0f0f0f;display:grid;place-items:center;cursor:pointer}
.viewer .thumb img{width:100%;height:100%;object-fit:cover}
.viewer .thumb[aria-current="true"]{outline:2px solid #ffd700;box-shadow:0 0 10px rgba(255,215,0,.5)}
.sheet{position:fixed;inset:0;z-index:1100;display:none}
.sheet.open{display:block}
.sheet .overlay{position:absolute;inset:0;background:rgba(0,0,0,.6)}
.sheet .panel{position:absolute;left:50%;transform:translateX(-50%);width:min(720px,92vw);background:linear-gradient(180deg,#111214,#0f0f11);border:1px solid #232323;border-radius:16px;box-shadow:0 30px 80px rgba(0,0,0,.55);max-height:80vh;overflow:auto;padding:14px;top:8vh}
@media (max-width:740px){.sheet .panel{left:0;right:0;transform:none;width:auto;border-radius:16px 16px 0 0;bottom:0;top:auto;max-height:78vh;animation:rise .22s ease-out}@keyframes rise{from{transform:translateY(18px)}to{transform:translateY(0)}}}
.sheet h3{margin:.1rem 0 .4rem;color:#ffd700;font-size:1.05rem}
.sheet p{margin:.45rem 0;color:#d0d0d0;line-height:1.6;white-space:pre-wrap}
.sheet .head{display:flex;justify-content:space-between;align-items:center;gap:.6rem}
.sheet .close{border:1px solid #444;background:#151515;color:#eee;border-radius:10px;padding:.45rem .7rem;cursor:pointer}
.sheet .actions{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.6rem}
.sheet .link{display:inline-flex;align-items:center;gap:.4rem;padding:.55rem .8rem;border-radius:10px;border:1px solid #2a2a2a;background:#141414;color:#eaeaea;text-decoration:none}
.sheet .link.main{background:linear-gradient(90deg,#ffd700,#e6c200);color:#000;border-color:#5c4a00;font-weight:900}
</style>
</head>
<body>
<div class="topbar">
  <div class="brand-mini"><img src="Ghidorah1.png" alt="Ghidorah" /><strong>Ghidorah no Sekai</strong></div>
  <div class="searchbar">
    <input id="q" placeholder="Search title, author, series…" aria-label="Search" />
  </div>
  <a href="rules.html" class="rules" aria-label="Vault Rules">⚖️ Rules</a>
</div>

<header>
  <div class="logo-wrapper" aria-hidden="true">
    <div class="logo-glow"></div>
    <img src="Ghidorah1.png" alt="Ghidorah no Sekai logo" class="logo" width="96" height="96" />
  </div>
  <h1>Ghidorah no Sekai</h1>
  <div class="subtitle">Rare Manga & Comics Showcase — Underground Vault</div>
  <div class="jp-bottom" aria-label="Gidora no Sekai">ギドラの世界</div>
  <div class="controls" role="group" aria-label="Quick filters">
    <button class="control-chip" id="filter-available" aria-pressed="false">Available only</button>
    <button class="control-chip" id="sort-rarity" aria-pressed="false">Sort by rarity</button>
    <button class="control-chip" id="filter-cat" aria-pressed="false">Category: All</button>
  </div>
</header>

<main class="container">
  <section class="grid" id="items" aria-live="polite"></section>
</main>

<footer>© 2025 Ghidorah no Sekai — Vintage &amp; Rare Comics Vault</footer>

<div id="viewer" class="viewer" aria-hidden="true">
  <button class="close" aria-label="Close">✕</button>
  <button class="nav prev" aria-label="Previous">‹</button>
  <img alt="Preview" />
  <button class="nav next" aria-label="Next">›</button>
  <div class="thumbs" role="tablist" aria-label="Thumbnails"></div>
</div>

<div id="sheet" class="sheet" aria-hidden="true">
  <div class="overlay"></div>
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
    <div class="head">
      <h3 id="sheetTitle"></h3>
      <button class="close" aria-label="Close">✕</button>
    </div>
    <div id="sheetTags" style="display:flex;gap:.4rem;flex-wrap:wrap;margin:.4rem 0 .6rem"></div>
    <p id="sheetBody"></p>
    <div class="actions">
      <a id="sheetMail" class="link main" href="#">Contact</a>
      <a id="sheetShare" class="link" href="#">Share</a>
    </div>
  </div>
</div>

<div id="catPicker" class="sheet" aria-hidden="true">
  <div class="overlay"></div>
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="catTitle">
    <div class="head">
      <h3 id="catTitle">Filter by category</h3>
      <button class="close" aria-label="Close">✕</button>
    </div>
    <div id="catList" style="display:grid;gap:.5rem"></div>
  </div>
</div>

<script>
class VaultCard extends HTMLElement{
  static get observedAttributes(){return["title","desc","imgs","rarity","stock","total","isnew","id","category","lang"]}
  constructor(){
    super();this._idx=0;this._slides=[];this._fullDesc="";
    this.attachShadow({mode:"open"});
    this.shadowRoot.innerHTML=`
      <style>
        :host{display:block;height:100%}
        .card{display:flex;flex-direction:column;overflow:hidden;border:1px solid var(--border);background:var(--card);border-radius:var(--radius);height:100%;box-shadow:0 4px 14px rgba(0,0,0,.28);transition:transform .15s ease, box-shadow .15s ease}
        .card:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(0,0,0,.4)}
        .media{--media-ratio:var(--card-media-ratio);position:relative;overflow:hidden;aspect-ratio:var(--media-ratio);background:radial-gradient(120% 80% at 50% 0%, rgba(255,215,0,.06), transparent 60%), linear-gradient(180deg,#0d0d10,#15151a);display:flex;align-items:center;justify-content:center;isolation:isolate;cursor:zoom-in}
        .media::after{content:"";position:absolute;inset:0;z-index:0;pointer-events:none;background:repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 1px, transparent 1px 6px);opacity:.08}
        .carousel{position:absolute;inset:0;z-index:1}
        .track{display:flex;height:100%;align-items:stretch;transition:transform .28s ease}
        .slide{margin:0;min-width:100%;height:100%;display:grid;place-items:center;position:relative}
        .slide img{max-width:100%;max-height:100%;width:auto;height:auto;object-fit:contain;object-position:center;display:block;vertical-align:middle;image-orientation:from-image}
        .noimg{display:grid;place-items:center;height:100%;width:100%}
        .noimg .glyph{font-size:30px;color:var(--gold);opacity:.9}
        .more{position:absolute;right:.45rem;bottom:.45rem;background:rgba(0,0,0,.6);border:1px solid rgba(255,255,255,.35);color:#fff;border-radius:10px;padding:.12rem .45rem;font-size:.78rem;backdrop-filter:blur(2px);display:none}
        .has-more .more{display:block}
        .info{position:absolute;left:.45rem;bottom:.45rem;z-index:3;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,.25);background:rgba(0,0,0,.5);color:#ffd700;cursor:pointer;backdrop-filter:blur(2px)}
        .info:focus-visible{outline:none;box-shadow:0 0 0 3px var(--ring)}
        .nav{position:absolute;top:50%;transform:translateY(-50%);border:none;background:rgba(0,0,0,.35);color:#fff;width:32px;height:32px;border-radius:999px;display:none;align-items:center;justify-content:center;cursor:pointer}
        .nav.prev{left:.45rem}.nav.next{right:.45rem}
        @media (hover:hover){.nav.multi{display:flex}}
        .dots{position:absolute;left:0;right:0;bottom:.42rem;display:flex;gap:.3rem;justify-content:center;z-index:2}
        .dot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,.35);border:1px solid rgba(255,255,255,.25)}
        .dot[aria-current="true"]{background:#FFD700;box-shadow:0 0 8px rgba(255,215,0,.6)}
        .tag{position:absolute;left:.55rem;top:.55rem;z-index:3;display:none;align-items:center;gap:.4rem;padding:.26rem .55rem;border-radius:999px;background:linear-gradient(90deg,#1d1600,#2a2200);border:1px solid rgba(255,215,0,.30);color:#FFD700;font-weight:800;letter-spacing:.08em;font-size:.72rem;box-shadow:0 0 0 1px rgba(255,215,0,.08) inset, 0 0 14px rgba(255,215,0,.22);overflow:hidden}
        .tag.sparkle{display:inline-flex}
        .tag .dot{width:8px;height:8px;border-radius:50%;background:#FFD700;box-shadow:0 0 8px #FFD700,0 0 16px rgba(255,215,0,.6),0 0 24px rgba(255,215,0,.35)}
        .tag::after{content:"";position:absolute;inset:-150% -40% auto -40%;height:300%;transform:rotate(25deg);background:linear-gradient(90deg,transparent,rgba(255,255,255,.38),transparent);animation:shine 2.6s linear infinite}
        .tag::before{content:"✦";position:absolute;right:-2px;top:-6px;font-size:14px;animation:twinkle 1.6s ease-in-out infinite alternate}
        @keyframes shine{0%{transform:translateX(-120%) rotate(25deg)}100%{transform:translateX(120%) rotate(25deg)}}
        @keyframes twinkle{0%{opacity:.4;transform:scale(.9) rotate(0)}100%{opacity:1;transform:scale(1.18) rotate(8deg)}}
        .seal{position:absolute;top:.55rem;right:.55rem;background:linear-gradient(90deg,#111,#2a2300);border:1px solid rgba(255,215,0,.24);color:#FFD700;padding:.22rem .5rem;border-radius:999px;font-size:.7rem;z-index:3}
        .body{display:flex;flex-direction:column;gap:6px;padding:10px;background:linear-gradient(180deg,#101114,#0f0f11)}
        h2{font-size:1rem;line-height:1.2;margin:0;color:var(--gold);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:2.4em;cursor:pointer}
        .desc{margin:0;color:var(--muted);font-size:.95rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:2.6em}
        .meta{display:flex;justify-content:space-between;align-items:center;font-size:.85rem}
        .qty{color:#bbb;border:1px dashed #333;border-radius:999px;padding:2px 8px}
        .stars{display:inline-flex;gap:2px}
        .stars .s{font-weight:900;background:linear-gradient(90deg,#C9B037,#FFD700,#b8860b,#FFD700);background-size:200% auto;-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;color:transparent;animation:starshine 6s linear infinite, twinkle 2.2s ease-in-out infinite alternate;text-shadow:0 0 10px rgba(255,215,0,.15)}
        .stars .s:nth-child(odd){animation-delay:.25s}
        @keyframes starshine{0%{background-position:0% center}100%{background-position:200% center}}
        .btn{display:block;margin-top:6px;text-align:center;background:linear-gradient(90deg,#ffd700,#e6c200);color:#000;font-weight:800;border-radius:10px;padding:10px;text-decoration:none;transition:transform .12s ease, box-shadow .12s ease}
        .btn:hover{transform:translateY(-1px);box-shadow:0 0 0 3px var(--ring)}
        .soldout .btn{background:linear-gradient(90deg,#555,#666);color:#eee}
        .soldout .slide img{filter:grayscale(1) contrast(.95) opacity(.9)}
      </style>
      <article class="card">
        <div class="media">
          <div class="carousel">
            <div class="track"></div>
            <button class="nav prev" aria-label="Previous">‹</button>
            <button class="nav next" aria-label="Next">›</button>
            <div class="dots" role="tablist"></div>
          </div>
          <button class="info" title="Read more" aria-label="Read more">…</button>
          <div class="more" aria-hidden="true"></div>
          <div class="tag"><span class="dot"></span>NEW</div>
          <span class="seal"></span>
        </div>
        <div class="body">
          <h2></h2>
          <p class="desc"></p>
          <div class="meta"><span class="stars"></span><span class="qty"></span></div>
          <a class="btn" href="#" rel="nofollow noopener"></a>
        </div>
      </article>
    `;
  }
  attributeChangedCallback(){this.render()}
  connectedCallback(){this.render()}
  render(){
    const r=this.shadowRoot;
    const title=this.getAttribute("title")||"";
    const desc=this.getAttribute("desc")||"";
    this._fullDesc=desc;
    let imgs=[];try{imgs=JSON.parse(this.getAttribute("imgs")||"[]")}catch{imgs=[]}
    imgs=(Array.isArray(imgs)?imgs:[]).filter(Boolean);
    const rarity=Math.max(0,Math.min(5,Number(this.getAttribute("rarity")||"0")));
    const stock=Number(this.getAttribute("stock")||"0");
    const total=Number(this.getAttribute("total")||stock||1);
    const isNew=this.getAttribute("isnew")==="1";
    const available=stock>0;
    const media=r.querySelector(".media");
    const track=r.querySelector(".track");
    const dots=r.querySelector(".dots");
    const prev=r.querySelector(".nav.prev");
    const next=r.querySelector(".nav.next");
    const tag=r.querySelector(".tag");
    const seal=r.querySelector(".seal");
    const overflow=r.querySelector(".more");
    const infoBtn=r.querySelector(".info");
    track.innerHTML="";dots.innerHTML="";
    const PREVIEW_MAX=6;
    const allSlides=imgs.length?imgs:["__NOIMG__"];
    this._slides=allSlides.slice(0,PREVIEW_MAX);
    const extra=Math.max(0,allSlides.length-this._slides.length);
    media.classList.toggle("has-more",extra>0);
    overflow.textContent=extra>0?`+${extra}`:"";
    this._idx=Math.min(this._idx,this._slides.length-1);this._idx=Math.max(this._idx,0);
    this._slides.forEach((src,i)=>{
      const slide=document.createElement("figure");slide.className="slide";
      if(src==="__NOIMG__"){slide.innerHTML=`<div class="noimg" aria-label="No image"><div class="glyph">無</div></div>`}
      else{const im=document.createElement("img");im.loading="lazy";im.decoding="async";im.alt=title?`Cover — ${title}`:"";im.addEventListener("error",()=>{slide.innerHTML=`<div class="noimg"><div class="glyph">無</div></div>`},{once:true});im.src=src;slide.appendChild(im)}
      track.appendChild(slide);
      if(this._slides.length>1){const dot=document.createElement("button");dot.className="dot";dot.type="button";dot.setAttribute("aria-label",`Slide ${i+1}`);dot.onclick=()=>this._go(i);dots.appendChild(dot)}
    });
    media.onclick=(e)=>{if(e.target&&e.target.classList.contains("info"))return;const all=allSlides.filter(s=>s!=="__NOIMG__");if(all.length)window.dispatchEvent(new CustomEvent("open-viewer",{detail:{imgs:all,index:this._idx}}))};
    const upd=()=>{track.style.transform=`translateX(-${this._idx*100}%)`;[...dots.children].forEach((d,i)=>d.setAttribute("aria-current",String(i===this._idx)))};
    this._go=(i)=>{this._idx=(i+this._slides.length)%this._slides.length;upd()};
    prev.onclick=()=>this._go(this._idx-1);
    next.onclick=()=>this._go(this._idx+1);
    const multi=this._slides.length>1;
    prev.style.display=next.style.display=multi?"flex":"none";
    prev.classList.toggle("multi",multi);next.classList.toggle("multi",multi);
    dots.style.display=multi?"flex":"none";
    upd();
    let sx=0,cx=0,drag=false;
    const down=e=>{drag=true;sx=(e.touches?e.touches[0].clientX:e.clientX);cx=sx};
    const move=e=>{if(!drag)return;cx=(e.touches?e.touches[0].clientX:e.clientX)};
    const up=()=>{if(!drag)return;const dx=cx-sx;drag=false;if(Math.abs(dx)>50){dx<0?this._go(this._idx+1):this._go(this._idx-1)}};
    track.parentElement.addEventListener("pointerdown",down);track.parentElement.addEventListener("pointermove",move);track.parentElement.addEventListener("pointerup",up);
    track.parentElement.addEventListener("touchstart",down,{passive:true});track.parentElement.addEventListener("touchmove",move,{passive:true});track.parentElement.addEventListener("touchend",up,{passive:true});
    tag.classList.toggle("sparkle",!!isNew);
    const qtyTxt=available?(total>1?`${stock}/${total}`:`1/1`):"SOLD OUT";
    seal.textContent=available?`AVAILABLE — ${qtyTxt}`:qtyTxt;
    r.querySelector("h2").textContent=title;
    r.querySelector(".desc").textContent=this._fullDesc||"";
    const openSheet=()=>window.dispatchEvent(new CustomEvent("open-sheet",{detail:{title,desc:this._fullDesc||"",category:this.getAttribute("category")||"",lang:this.getAttribute("lang")||""}}));
    infoBtn.onclick=openSheet;
    r.querySelector("h2").onclick=openSheet;
    const stars=r.querySelector(".stars");stars.innerHTML="";
    for(let i=0;i<rarity;i++){const s=document.createElement("span");s.className="s";s.textContent="★";stars.appendChild(s)}
    r.querySelector(".qty").textContent=available?(total>1?`In vault: ${stock}/${total}`:"unique"):"sold";
    const cta=r.querySelector(".btn");
    cta.textContent=available?"Contact us":"Request restock";
    cta.href=available?`mailto:ghidorahnosekai@example.com?subject=${encodeURIComponent("Info — "+title)}`:`mailto:ghidorahnosekai@example.com?subject=${encodeURIComponent("Waitlist — "+title)}`;
    cta.setAttribute("aria-label",cta.textContent+" for "+title);
  }
}
customElements.define("vault-card",VaultCard);
</script>

<script>
window.io=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){e.target.classList.add("reveal");window.io.unobserve(e.target)}})},{rootMargin:"60px"});
document.addEventListener("contextmenu",e=>e.preventDefault(),{passive:!1});
window.addEventListener("keydown",e=>{const t=(e.key||"").toLowerCase();("f12"===t||e.ctrlKey&&"u"===t||e.ctrlKey&&e.shiftKey&&["i","j","c","s"].includes(t))&&(e.preventDefault(),e.stopPropagation())},!0);
const canon=document.getElementById("canon");try{canon.href=location.href.split("#")[0]}catch{}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig={apiKey:"AIzaSyC7qhjI3lRxqZGbvmTQscetvvhuE8T4N4I",authDomain:"wandernatureconnect.firebaseapp.com",databaseURL:"https://wandernatureconnect-default-rtdb.europe-west1.firebasedatabase.app",projectId:"wandernatureconnect",storageBucket:"wandernatureconnect.appspot.com",messagingSenderId:"1062563433646",appId:"1:1062563433646:web:a7251b914f569fc105f13f",measurementId:"G-SGF0KC717J"};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const CAT_LABELS={editoriale_corno:"Editoriale Corno",usa_comics:"USA Comics",art:"Art",manga_japanese:"Manga (Japanese)",manga_italian:"Manga (Italian)",misc:"Misc"};
const LANG_LABELS={it:"Italian",en:"English",ja:"Japanese",zh:"Chinese",fr:"French",de:"German",es:"Spanish"};

const container=document.getElementById("items");
const btnFilter=document.getElementById("filter-available");
const btnSort=document.getElementById("sort-rarity");
const btnCat=document.getElementById("filter-cat");
const qInput=document.getElementById("q");

const catPicker=document.getElementById("catPicker");
const catClose=catPicker.querySelector(".close");
const catList=document.getElementById("catList");

let filterAvailable=false, sortByRarity=false, filterCat="all", cache=[], view=[];

function renderSkeleton(n){container.innerHTML="";for(let i=0;i<n;i++){const d=document.createElement("div");d.className="skel";container.appendChild(d)}}
function renderEmpty(){container.innerHTML=`<div style="grid-column:1/-1;color:#bbb;text-align:center;padding:24px;border:1px dashed #333;border-radius:12px">Vault is empty</div>`}

function updateJsonLd(list){
  document.getElementById("ld-items")?.remove();
  const data={"@context":"https://schema.org","@type":"ItemList","name":"Ghidorah no Sekai — Rare Manga & Comics Showcase","itemListElement":list.map((it,idx)=>({"@type":"Product","position":idx+1,"name":it.title||"Untitled","description":it.desc||"","image":(Array.isArray(it.imgs)&&it.imgs[0])||it.img||"","brand":{"@type":"Brand","name":"Ghidorah no Sekai"},"category":"ComicBook","url":location.href,"offers":{"@type":"Offer","availability":(it.stock??0)>0?"https://schema.org/InStock":"https://schema.org/OutOfStock","priceCurrency":"EUR","price":"0"}}))};
  const s=document.createElement("script");s.type="application/ld+json";s.id="ld-items";s.textContent=JSON.stringify(data);document.head.appendChild(s);
}

function chunkedRender(list){
  container.innerHTML="";
  if(!Array.isArray(list)||list.length===0){renderEmpty();updateJsonLd([]);return}
  const frag=document.createDocumentFragment();
  const BATCH=16;
  let i=0;
  const step=()=>{
    const limit=Math.min(i+BATCH,list.length);
    for(;i<limit;i++){
      const item=list[i];
      const el=document.createElement("vault-card");
      const imgs=Array.isArray(item.imgs)?item.imgs.filter(Boolean):(item.img?[item.img]:[]);
      el.setAttribute("id",item.id??"");
      el.setAttribute("title",item.title??"Untitled");
      el.setAttribute("desc",item.desc??"");
      el.setAttribute("imgs",JSON.stringify(imgs));
      el.setAttribute("rarity",String(item.rarity??1));
      el.setAttribute("stock",String(item.stock??0));
      el.setAttribute("total",String(item.total??Math.max(1,item.stock||1)));
      el.setAttribute("category",item.category||"");
      el.setAttribute("lang",item.lang||"");
      const fresh=(Date.now()-(item.addedAt||0))<=604800000;
      if(fresh)el.setAttribute("isnew","1");
      frag.appendChild(el);
      window.io?.observe?.(el);
    }
    container.appendChild(frag);
    if(i<list.length)requestAnimationFrame(step);else updateJsonLd(list);
  };
  requestAnimationFrame(step);
}

function applyView(){
  let data=[...cache];
  const term=(qInput.value||"").toLowerCase().trim();
  if(term)data=data.filter(i=>(`${i.title||""} ${i.desc||""}`).toLowerCase().includes(term));
  if(filterAvailable)data=data.filter(i=>(i?.stock??0)>0);
  if(filterCat!=="all")data=data.filter(i=>(i.category||"")===filterCat);
  if(sortByRarity)data.sort((a,b)=>(b?.rarity??0)-(a?.rarity??0));
  view=data;
  chunkedRender(view);
}

renderSkeleton(8);

const itemsRef=ref(db,"items");
onValue(itemsRef,(snap)=>{
  const obj=snap.val();
  if(obj==null){cache=[];applyView();return}
  let arr=Object.entries(obj).map(([id,v])=>({id,...v}));
  arr=arr.filter(x=>x&&(x.published===true||x.published===1||x.published==="true"||typeof x.published==="undefined"));
  arr.sort((a,b)=>(b?.addedAt??0)-(a?.addedAt??0));
  cache=arr;applyView();
},()=>{renderEmpty()});

btnFilter?.addEventListener("click",()=>{filterAvailable=!filterAvailable;btnFilter.setAttribute("aria-pressed",String(filterAvailable));applyView()});
btnSort?.addEventListener("click",()=>{sortByRarity=!sortByRarity;btnSort.setAttribute("aria-pressed",String(sortByRarity));applyView()});
function debounce(fn,ms){let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}}
qInput?.addEventListener("input",debounce(applyView,120));

function openCatPicker(){
  catList.innerHTML="";
  const opts=[["all","All"],...Object.entries(CAT_LABELS)];
  opts.forEach(([val,label])=>{
    const a=document.createElement("a");
    a.href="#";a.className="link";a.textContent=label;
    a.onclick=(e)=>{e.preventDefault();filterCat=val;btnCat.textContent="Category: "+label;btnCat.setAttribute("aria-pressed",String(val!=="all"));catPicker.classList.remove("open");catPicker.setAttribute("aria-hidden","true");applyView()};
    catList.appendChild(a);
  });
  catPicker.classList.add("open");catPicker.setAttribute("aria-hidden","false");
}
btnCat?.addEventListener("click",openCatPicker);
catClose?.addEventListener("click",()=>{catPicker.classList.remove("open");catPicker.setAttribute("aria-hidden","true")});
catPicker.querySelector(".overlay")?.addEventListener("click",()=>{catPicker.classList.remove("open");catPicker.setAttribute("aria-hidden","true")});

const viewer=document.getElementById("viewer");
const vImg=viewer.querySelector("img");
const vClose=viewer.querySelector(".close");
const vPrev=viewer.querySelector(".prev");
const vNext=viewer.querySelector(".next");
const vStrip=viewer.querySelector(".thumbs");
let vList=[],vIndex=0;
function vRender(){
  vImg.src=vList[vIndex]||"";
  vStrip.innerHTML="";
  vList.forEach((src,i)=>{
    const th=document.createElement("button");
    th.className="thumb";if(i===vIndex)th.setAttribute("aria-current","true");
    const im=document.createElement("img");im.loading="lazy";im.decoding="async";im.src=src;th.appendChild(im);
    th.onclick=()=>{vIndex=i;vRender()};vStrip.appendChild(th);
  });
  [vIndex-1,vIndex+1].forEach(k=>{const j=(k+vList.length)%vList.length;if(vList[j]){const pre=new Image();pre.src=vList[j]}});
}
function vOpen(list,start=0){vList=list;vIndex=Math.max(0,Math.min(start,list.length-1));viewer.classList.add("active");viewer.setAttribute("aria-hidden","false");vRender()}
function vCloseFn(){viewer.classList.remove("active");viewer.setAttribute("aria-hidden","true");vList=[];vIndex=0;vImg.removeAttribute("src");vStrip.innerHTML=''}
vClose.onclick=vCloseFn;vPrev.onclick=()=>{vIndex=(vIndex-1+vList.length)%vList.length;vRender()};vNext.onclick=()=>{vIndex=(vIndex+1)%vList.length;vRender()};
viewer.addEventListener("click",e=>{if(e.target===viewer)vCloseFn()});
window.addEventListener("keydown",e=>{if(!viewer.classList.contains("active"))return;if(e.key==="Escape")vCloseFn();if(e.key==="ArrowLeft")vPrev.click();if(e.key==="ArrowRight")vNext.click()});
let touchStartX=0;viewer.addEventListener("touchstart",e=>{touchStartX=e.touches[0].clientX},{passive:true});
viewer.addEventListener("touchend",e=>{const dx=(e.changedTouches[0].clientX-touchStartX);if(Math.abs(dx)>40){dx<0?vNext.click():vPrev.click()}},{passive:true});
window.addEventListener("open-viewer",(ev)=>{vOpen(ev.detail.imgs||[],ev.detail.index||0)});

const sheet=document.getElementById("sheet");
const shOverlay=sheet.querySelector(".overlay");
const shPanel=sheet.querySelector(".panel");
const shTitle=document.getElementById("sheetTitle");
const shBody=document.getElementById("sheetBody");
const shMail=document.getElementById("sheetMail");
const shShare=document.getElementById("sheetShare");
const shTags=document.getElementById("sheetTags");
const shClose=sheet.querySelector(".close");
let shOpenState=false,startY=0,deltaY=0;
function openSheet({title,desc,category,lang}){
  shTitle.textContent=title||"Details";
  shBody.textContent=desc||"";
  shTags.innerHTML="";
  const catTxt=CAT_LABELS[category]||null;
  const langTxt=LANG_LABELS[lang]||null;
  if(catTxt){const b=document.createElement("span");b.className="link";b.textContent=catTxt;shTags.appendChild(b)}
  if(langTxt){const b=document.createElement("span");b.className="link";b.textContent=langTxt;shTags.appendChild(b)}
  shMail.href=`mailto:ghidorahnosekai@example.com?subject=${encodeURIComponent("Info — "+(title||""))}`;
  shShare.onclick=(e)=>{e.preventDefault();const text=`${title||"Item"} — ${desc||""}`;if(navigator.share){navigator.share({title:title||"Ghidorah no Sekai",text})}else{navigator.clipboard?.writeText(text);alert("Copied to clipboard")}};
  sheet.classList.add("open");sheet.setAttribute("aria-hidden","false");shOpenState=true;
}
function closeSheet(){sheet.classList.remove("open");sheet.setAttribute("aria-hidden","true");shOpenState=false}
shClose.onclick=closeSheet;shOverlay.onclick=closeSheet;
window.addEventListener("keydown",e=>{if(shOpenState&&e.key==="Escape")closeSheet()});
window.addEventListener("open-sheet",(ev)=>openSheet(ev.detail||{}));
shPanel.addEventListener("touchstart",e=>{startY=e.touches[0].clientY;deltaY=0},{passive:true});
shPanel.addEventListener("touchmove",e=>{deltaY=e.touches[0].clientY-startY;if(deltaY>0){shPanel.style.transform=`translateY(${Math.min(deltaY,60)}px)`}},{passive:true});
shPanel.addEventListener("touchend",()=>{if(deltaY>60){closeSheet()}shPanel.style.transform=""},{passive:true});
</script>
</body>
</html>






